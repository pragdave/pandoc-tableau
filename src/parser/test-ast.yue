import "u-test" as test
import "util" as { :dump }

import "ast" as { :parse }

const t1 = \
[[ c1 | c2 | c3
d1 | d2 | d3
===
-- ignore this line and the blank that follows

# Caption, My Caption
]]

test["basic table with caption"] = () ->
  ast = parse(t1)
  test.equal ast.caption, "Caption, My Caption"

const t2 = \
[[ c1 | c2 | c3
d1 | d2 | d3
===
  r2-4 = fg(red2) width(20)
]]

test["single selector row with two formats"] = () ->
  ast = parse(t2)
  sf  = ast.selector_formats[1]
  sel = sf.selector
  f   = sf.formats
  test.equal 2, #f
  fg = f[1]
  test.equal fg.ground, "fg"
  test.equal fg.name, "red"
  test.equal fg.type, "named-color"
  w = f[2]
  test.equal w.spec, 20
  test.equal w.type, "width"
